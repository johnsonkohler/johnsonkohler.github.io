console.log("Last updated 2026-02-21 21:18")

// --------------------------------------------------------------------- global: dictionary

const dictionary = [[[["", "", "1st", "sing.", "pres.", "act.", "ind."], ["τίθημι"]], [["", "", "1st", "sing.", "pres.", "mid.", "ind."], ["τίθεμαι"]], [["", "", "1st", "sing.", "pres.", "pass.", "ind."], ["τίθεμαι"]], [["", "", "1st", "sing.", "fut.", "act.", "ind."], ["θήσω"]], [["", "", "1st", "sing.", "fut.", "mid.", "ind."], ["θήσομαι"]], [["", "", "1st", "sing.", "fut.", "pass.", "ind."], ["τεθήσομαι"]], [["", "", "1st", "sing.", "imperf.", "act.", "ind."], ["ἐτίθην"]], [["", "", "1st", "sing.", "imperf.", "mid.", "ind."], ["ἐτιθέμην"]], [["", "", "1st", "sing.", "imperf.", "pass.", "ind."], ["ἐτιθέμην"]], [["", "", "1st", "sing.", "aor.", "act.", "ind."], ["ἔθηκα"]], [["", "", "1st", "sing.", "aor.", "mid.", "ind."], ["ἔθέμην"]], [["", "", "1st", "sing.", "aor.", "pass.", "ind."], ["ἐτέθην"]], [["", "", "1st", "pl.", "pres.", "act.", "ind."], ["τίθεμεν"]], [["", "", "1st", "pl.", "pres.", "mid.", "ind."], ["τιθέμεθα"]], [["", "", "1st", "pl.", "pres.", "pass.", "ind."], ["τιθέμεθα"]], [["", "", "1st", "pl.", "fut.", "act.", "ind."], ["θήσομεν"]], [["", "", "1st", "pl.", "fut.", "mid.", "ind."], ["θησόμεθα"]], [["", "", "1st", "pl.", "fut.", "pass.", "ind."], ["τεθησόμεθα"]], [["", "", "1st", "pl.", "imperf.", "act.", "ind."], ["ἐτίθεμεν"]], [["", "", "1st", "pl.", "imperf.", "mid.", "ind."], ["ἐτιθέμεθα"]], [["", "", "1st", "pl.", "imperf.", "pass.", "ind."], ["ἐτιθέμεθα"]], [["", "", "1st", "pl.", "aor.", "act.", "ind."], ["ἔθεμεν"]], [["", "", "1st", "pl.", "aor.", "mid.", "ind."], ["ἐθέμεθα"]], [["", "", "1st", "pl.", "aor.", "pass.", "ind."], ["ἐτέθημεν"]], [["", "", "2nd", "sing.", "pres.", "act.", "ind."], ["τίθης"]], [["", "", "2nd", "sing.", "pres.", "mid.", "ind."], ["τίθεσαι"]], [["", "", "2nd", "sing.", "pres.", "pass.", "ind."], ["τίθεσαι"]], [["", "", "2nd", "sing.", "fut.", "act.", "ind."], ["θήσεις"]], [["", "", "2nd", "sing.", "fut.", "mid.", "ind."], ["θήσῃ"]], [["", "", "2nd", "sing.", "fut.", "pass.", "ind."], ["τεθήσῃ"]], [["", "", "2nd", "sing.", "imperf.", "act.", "ind."], ["ἐτίθεις"]], [["", "", "2nd", "sing.", "imperf.", "mid.", "ind."], ["ἐτίθεσο"]], [["", "", "2nd", "sing.", "imperf.", "pass.", "ind."], ["ἐτίθεσο"]], [["", "", "2nd", "sing.", "aor.", "act.", "ind."], ["ἔθηκας"]], [["", "", "2nd", "sing.", "aor.", "mid.", "ind."], ["ἔθου"]], [["", "", "2nd", "sing.", "aor.", "pass.", "ind."], ["ἐτέθης"]], [["", "", "2nd", "pl.", "pres.", "act.", "ind."], ["τίθετε"]], [["", "", "2nd", "pl.", "pres.", "mid.", "ind."], ["τίθεσθε"]], [["", "", "2nd", "pl.", "pres.", "pass.", "ind."], ["τίθεσθε"]], [["", "", "2nd", "pl.", "fut.", "act.", "ind."], ["θήσετε"]], [["", "", "2nd", "pl.", "fut.", "mid.", "ind."], ["θήσεσθε"]], [["", "", "2nd", "pl.", "fut.", "pass.", "ind."], ["τεθήσεσθε"]], [["", "", "2nd", "pl.", "imperf.", "act.", "ind."], ["ἐτίθετε"]], [["", "", "2nd", "pl.", "imperf.", "mid.", "ind."], ["ἐτίθεσθε"]], [["", "", "2nd", "pl.", "imperf.", "pass.", "ind."], ["ἐτίθεσθε"]], [["", "", "2nd", "pl.", "aor.", "act.", "ind."], ["ἔθετε"]], [["", "", "2nd", "pl.", "aor.", "mid.", "ind."], ["ἔθεσθε"]], [["", "", "2nd", "pl.", "aor.", "pass.", "ind."], ["ἐτέθητε"]], [["", "", "3rd", "sing.", "pres.", "act.", "ind."], ["τίθησι(ν)"]], [["", "", "3rd", "sing.", "pres.", "mid.", "ind."], ["τίθεται"]], [["", "", "3rd", "sing.", "pres.", "pass.", "ind."], ["τίθεται"]], [["", "", "3rd", "sing.", "fut.", "act.", "ind."], ["θήσει"]], [["", "", "3rd", "sing.", "fut.", "mid.", "ind."], ["θήσεται"]], [["", "", "3rd", "sing.", "fut.", "pass.", "ind."], ["τεθήσεσθε"]], [["", "", "3rd", "sing.", "imperf.", "act.", "ind."], ["ἐτίθει"]], [["", "", "3rd", "sing.", "imperf.", "mid.", "ind."], ["ἐτίθετο"]], [["", "", "3rd", "sing.", "imperf.", "pass.", "ind."], ["ἐτίθετο"]], [["", "", "3rd", "sing.", "aor.", "act.", "ind."], ["ἔθηκε(ν)"]], [["", "", "3rd", "sing.", "aor.", "mid.", "ind."], ["ἔθετο"]], [["", "", "3rd", "sing.", "aor.", "pass.", "ind."], ["ἐτέθη"]], [["", "", "3rd", "pl.", "pres.", "act.", "ind."], ["τιθέασι(ν)"]], [["", "", "3rd", "pl.", "pres.", "mid.", "ind."], ["τίθενται"]], [["", "", "3rd", "pl.", "pres.", "pass.", "ind."], ["τίθενται"]], [["", "", "3rd", "pl.", "fut.", "act.", "ind."], ["θήσουσι(ν)"]], [["", "", "3rd", "pl.", "fut.", "mid.", "ind."], ["θήσονται"]], [["", "", "3rd", "pl.", "fut.", "pass.", "ind."], ["τεθήσονται"]], [["", "", "3rd", "pl.", "imperf.", "act.", "ind."], ["ἐτίθεσαν"]], [["", "", "3rd", "pl.", "imperf.", "mid.", "ind."], ["ἐτίθεντο"]], [["", "", "3rd", "pl.", "imperf.", "pass.", "ind."], ["ἐτίθεντο"]], [["", "", "3rd", "pl.", "aor.", "act.", "ind."], ["ἔθεσαν"]], [["", "", "3rd", "pl.", "aor.", "mid.", "ind."], ["ἔθεντο"]], [["", "", "3rd", "pl.", "aor.", "pass.", "ind."], ["ἐτέθησαν"]]]];
  
//test dictionary: [[  [ ["1st", "sing", "present"], ["I dive"] ],  [ ["3rd", "sing", "present"], ["she dives"] ],  [ ["", "", "past"], ["dived", "dove"] ],  [ ["", "", "inf"], ["to dive"] ]  ], [  [ ["1st", "sing", "present"], ["I run"] ],  [ ["3rd", "sing", "present"], ["she runs"] ],  [ ["", "", "past"], ["ran"] ],  [ ["", "", "inf"], ["to run"] ]  ], [  [ ["1st", "sing", "present"], ["I can"] ],  [ ["3rd", "sing", "present"], ["she can"] ],  [ ["", "", "past"], ["could"] ]  ]]

// --------------------------------------------------------------------- global: acceptable values

const acceptableValues = [["1st", "2nd", "3rd"], ["sing.", "pl."], ["pres.", "fut.", "imperf.", "aor."], ["act.", "mid.", "pass."]];
  
//testing purposes: [["1st", "3rd"], ["sing"], ["present", "past", "inf"]];

// =
// gender: ["m.", "f.", "n."]
// case: ["nom."]
// person: ["1st", "2nd", "3rd"]
// number: ["sing.", "pl."]
// tense: ["pres.", "fut.", "imperf.", "aor."]
// voice: ["act.", "mid.", "pass."]
// mood: ["ind.", "imp.", "inf.", "part."]

// --------------------------------------------------------------------- other global vars

//var currentWord = ""; //top-level entry in the dictionary
var currentWord = dictionary[0]; //...while there's only one word in the dictionary
var currentQuestion = ""; //sub-entry containing the displayed PROMPT WORD and its hidden INFLECTION DATA
var correctAnswer = ""; //the sub-entry containing the hidden ANSWER WORD and its displayed INFLECTION DATA
var wordUses = 0;

var recentAnswers = [];

const promptWord = document.getElementById("promptWord");
const promptForm = document.getElementById("promptForm");
const answerBox = document.getElementById("answerBox");
const submitButton = document.getElementById("submitButton");
const feedback = document.getElementById("feedback");

// --------------------------------------------------------------------- defining setting 1

function newQuestionSettingOne() {

  //-------------------------------------------------------------------- Setup

  submitButton.setAttribute("onclick", "event.preventDefault(); checkAnswer();")
  submitButton.setAttribute("value", "Check");
  
  feedback.innerText = "Conjugate the verb above in the form provided.";
  for (var i=0; i<document.getElementsByName("answerBox").length; i++) document.getElementsByName("answerBox")[i].value = "";

  // Math.floor(Math.random() * 10) returns a random int 0 through 9 inclusive
  
  const answerBoxes = document.getElementsByName("answerBox");
  for (let i=1; i<answerBoxes.length; i++) answerBoxes[i].type = "hidden";

  // while there's only one word in the dictionary...
  if (wordUses == 0) { //normally if (wordUses%3 == 0)
    //var temp = currentWord;
    //while (temp == currentWord) temp = dictionary[Math.floor(Math.random() * dictionary.length)]
    //currentWord = temp;

    recentAnswers = [];

    currentQuestion = currentWord[Math.floor(Math.random() * currentWord.length)]
  }
  else {
    recentAnswers.push(currentQuestion);
    recentAnswers.push(correctAnswer);
    currentQuestion = correctAnswer;
  }
  wordUses++;

  //-------------------------------------------------------------------- Selecting an answer
  var validAnswersCollected = false;
  var attempts = 0;
  const maxAttempts = currentWord.length*10;

  while (!validAnswersCollected) {
  attempts++;
    
  const varToChange = Math.floor(Math.random() * currentQuestion[0].length)
  var newValue = currentQuestion[0][varToChange];
  if (acceptableValues[varToChange].length < 2) continue;
  while (newValue == currentQuestion[0][varToChange]) newValue = acceptableValues[varToChange][Math.floor(Math.random() * acceptableValues[varToChange].length)];

  validAnswers = [];
  for (const entry of currentWord) {
    if (entry[0][varToChange] != newValue) continue;
    var valid = true;
    for (var j=0; j<entry[0].length; j++) {
      if (j == varToChange) continue;
      if (entry[0][j] == "" || currentQuestion[0][j] == "" || entry[0][j] == currentQuestion[0][j]) continue;
      valid = false;
    }
    if (valid) validAnswers.push(entry);
  }

  var existsNewAnswerLine = false
  for (var i=0; i<validAnswers.length; i++) {
    //replacing if (validAnswer[1] != currentQuestion[1]) existsNewAnswerLine = true;
    var recentlyUsed = false;
    for (const recentAnswer of recentAnswers) if (validAnswers[i][1] == recentAnswer[1]) recentlyUsed = true;
    if (!recentlyUsed) {
      existsNewAnswerLine = true;
    } else {
      var tempArr = [];
      for (var j=0; j<i; j++) tempArr.push(validAnswers[j]);
      for (var j=i+1; j<validAnswers.length; j++) tempArr.push(validAnswers[j]);
      validAnswers = tempArr;
      i--;
    }
  }
  if (validAnswers.length > 0 && existsNewAnswerLine) validAnswersCollected = true;
    
  if (attempts > maxAttempts) {
    validAnswers = [];
    var randomNewAnswer = currentWord[Math.floor(Math.random() * currentWord.length)];
    while (randomNewAnswer[1] == currentQuestion[1]) randomNewAnswer = currentWord[Math.floor(Math.random() * currentWord.length)];
    validAnswers.push(randomNewAnswer);
    break;
  }
  }
  
  var tentative = validAnswers[Math.floor(Math.random() * validAnswers.length)];
  
  // ^ replacing while (tentative[1] == currentQuestion[1]) tentative = validAnswers[Math.floor(Math.random() * validAnswers.length)];
  
  correctAnswer = tentative;

  //-------------------------------------------------------------------- Display
  
  var promptText = "";
  for (var i=0; i<currentQuestion[1].length-1; i++) {
      promptText += ` ${currentQuestion[1][i]}` + ",";
    }
  promptText += ` ${currentQuestion[1][currentQuestion[1].length-1]}`;
  promptWord.innerText = promptText;
  
  promptText = "";
  for (var i=0; i<correctAnswer[0].length; i++) promptText += correctAnswer[0][i] + " "
  promptForm.innerText = promptText;

}

function checkAnswer() {
  
  //collect inputs
  const inputs = document.getElementsByName("answerBox");
  var userAnswers = [];
  for (var i=0; i<inputs.length; i++) {
    if (inputs[i].value != "") userAnswers.push(inputs[i].value);
  }

  //check to make sure all correct answers were inputted
  var allCorrect = true;
  for (var i=0; i<correctAnswer[1].length; i++) {
    for (var j=0; j<userAnswers.length+1; j++) {
      if (correctAnswer[1][i] == userAnswers[j]) break;
      if (j == userAnswers.length) allCorrect = false;
    }
  }

  //check to make sure no incorrect answers are represented
  var noneWrong = true;
  for (var i=0; i<userAnswers.length; i++) {
    for (var j=0; j<correctAnswer[1].length; j++) {
      if (correctAnswer[1][j] == userAnswers[i]) break;
      if (j == correctAnswer[1].length) noneWrong = false;
    }
  }

  //display feedback
  if (allCorrect && noneWrong) {
    feedback.innerText = "Correct!"
  } else {
    feedback.innerText = "Nope. Correct answer:";
    for (var i=0; i<correctAnswer[1].length-1; i++) {
      feedback.innerText += ` ${correctAnswer[1][i]}` + ",";
    }
    feedback.innerText += ` ${correctAnswer[1][correctAnswer[1].length-1]}`;
  }

  //update button
  submitButton.setAttribute("onclick", "event.preventDefault(); newQuestionSettingOne();")
  submitButton.setAttribute("value", "Next");

}

function addField() {
  const answerBoxes = document.getElementsByName("answerBox");
  for (const box of answerBoxes) {
    if (box.type == "hidden") {
      box.type = "text";
      return;
    }
  }
  alert("No more fields to add!");
}

newQuestionSettingOne();
